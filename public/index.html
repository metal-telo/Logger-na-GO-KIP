<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.3.4/vue.global.min.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background-color: rgb(62, 66, 84);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 10px;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        padding: 30px;
      }

      h1 {
        text-align: center;
        margin-bottom: 30px;
        font-size: 2.5em;
      }

      .tabs {
        display: flex;
        margin-bottom: 30px;
        border-bottom: 2px solid #e0e0e0;
      }

      .tab {
        background: none;
        border: none;
        padding: 15px 25px;
        cursor: pointer;
        font-size: 16px;
        color: #666;
        transition: all 0.3s ease;
        border-bottom: 3px solid transparent;
      }

      .tab.active {
        color: #667eea;
        border-bottom-color: #667eea;
        background: rgba(102, 126, 234, 0.1);
      }

      .tab:hover {
        background: rgba(102, 126, 234, 0.05);
        color: #667eea;
      }

      .department-selector {
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 15px;
        flex-wrap: wrap;
      }

      .department-selector label {
        font-weight: 600;
        color: #2c3e50;
      }

      select,
      input {
        width: 100%;
        padding: 12px;
        border: 2px solid #ddd;
        border-radius: 10px;
        font-size: 14px;
        transition: border-color 0.3s ease;
        background: white;
      }

      select:focus,
      input:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #2c3e50;
      }

      .form-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
      }

      .btn {
        padding: 12px 25px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-block;
        text-align: center;
      }

      .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }

      .btn-primary {
        background-color: #0086a1;
        color: white;
      }

      .btn-primary:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(74, 74, 74, 0.4);
      }

      .btn-danger {
        background-color: #bb4646;
        color: white;
      }

      .btn-danger:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
      }

      .btn-success {
        background-color: #38be6f;
        color: white;
      }

      .btn-success:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px #2ecc7166;
      }

      .btn-secondary {
        background: #6c757d;
        color: white;
      }

      .btn-secondary:hover:not(:disabled) {
        background: #5a6268;
        transform: translateY(-2px);
      }

      .employee-list {
        display: grid;
        gap: 20px;
      }

      .employee-card {
        background: white;
        border-radius: 10px;
        padding: 25px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        border: 1px solid #f0f0f0;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }

      .employee-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
      }

      .employee-card.fired {
        opacity: 0.6;
        background: #ffffff;
        border-color: #dc3545;
      }

      .employee-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 15px;
        flex-wrap: wrap;
        gap: 10px;
      }

      .employee-name {
        font-size: 1.3em;
        font-weight: bold;
        color: #2c3e50;
        flex: 1;
      }

      .employee-status {
        padding: 5px 12px;
        border-radius: 15px;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
      }

      .status-active {
        background: #d4edda;
        color: #155724;
      }

      .status-vacation {
        background: #fff3cd;
        color: #856404;
      }

      .status-fired {
        background: #f8d7da;
        color: #721c24;
      }

      .employee-info {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
      }

      .info-item {
        display: flex;
        flex-direction: column;
      }

      .info-label {
        font-size: 12px;
        color: #6c757d;
        text-transform: uppercase;
        font-weight: 600;
        margin-bottom: 5px;
      }

      .info-value {
        color: #2c3e50;
        font-weight: 500;
      }

      .employee-actions {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .search-filters {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 25px;
      }

      .filters-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        align-items: end;
      }

      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        backdrop-filter: blur(5px);
      }

      .modal {
        background: white;
        padding: 30px;
        border-radius: 15px;
        max-width: 600px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
      }

      .modal h3 {
        margin-bottom: 25px;
        color: #2c3e50;
        text-align: center;
      }

      .empty-state {
        text-align: center;
        padding: 50px 20px;
        color: #6c757d;
      }

      .empty-state h3 {
        margin-bottom: 15px;
        color: #2c3e50;
      }

      .loading {
        text-align: center;
        padding: 20px;
        color: #667eea;
        font-weight: 600;
      }

      .error {
        background: #f8d7da;
        color: #721c24;
        padding: 15px;
        border-radius: 5px;
        margin-bottom: 20px;
        border: 1px solid #f5c6cb;
      }

      .success {
        background: #d4edda;
        color: #155724;
        padding: 15px;
        border-radius: 5px;
        margin-bottom: 20px;
        border: 1px solid #c3e6cb;
      }

      @media (max-width: 768px) {
        .container {
          padding: 15px;
        }

        .tabs {
          flex-wrap: wrap;
        }

        .tab {
          flex: 1;
          min-width: 120px;
        }

        .form-row {
          grid-template-columns: 1fr;
        }

        .employee-header {
          flex-direction: column;
          align-items: flex-start;
        }

        .employee-actions {
          justify-content: flex-start;
        }
      }
    </style>
  </head>
  <body>
    <div id="app">
      <div class="container">
        <h1>–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏</h1>

        <!-- –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –∏ —É—Å–ø–µ—Ö–µ -->
        <div v-if="error" class="error">{{ error }}</div>
        <div v-if="success" class="success">{{ success }}</div>

        <div class="tabs">
          <button
            class="tab"
            :class="{ active: activeTab === 'list' }"
            @click="setActiveTab('list')"
          >
            –°–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
          </button>
          <button
            class="tab"
            :class="{ active: activeTab === 'create' }"
            @click="setActiveTab('create')"
          >
            –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
          </button>
          <button
            class="tab"
            :class="{ active: activeTab === 'search' }"
            @click="setActiveTab('search')"
          >
            –ü–æ–∏—Å–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
          </button>
        </div>

        <!-- –í—ã–±–æ—Ä –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞ -->
        <div class="department-selector" v-if="activeTab !== 'search'">
          <label>–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç:</label>
          <select
            v-model="selectedDepartmentId"
            @change="loadEmployees"
            :disabled="loading"
          >
            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç</option>
            <option v-for="dept in departments" :key="dept.id" :value="dept.id">
              {{ dept.name }}
            </option>
          </select>
          <span v-if="selectedDepartment && employees.length">
            –°–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤: <strong>{{ activeEmployees.length }}</strong>
          </span>
        </div>

        <!-- –°–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ -->
        <div v-if="activeTab === 'list'">
          <div v-if="loading" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤...</div>
          <div v-else-if="!selectedDepartmentId" class="empty-state">
            <h3>–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç</h3>
            <p>
              –î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–ø–∏—Å–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–±—Ä–∞—Ç—å –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç
            </p>
          </div>
          <div v-else-if="employees.length === 0" class="empty-state">
            <h3>–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
            <p>–í –≤—ã–±—Ä–∞–Ω–Ω–æ–º –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–µ –ø–æ–∫–∞ –Ω–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</p>
          </div>
          <div v-else class="employee-list">
            <div
              v-for="employee in employees"
              :key="employee.id"
              class="employee-card"
              :class="{ fired: employee.status === 'fired' }"
            >
              <div class="employee-header">
                <div class="employee-name">{{ employee.full_name }}</div>
                <div
                  class="employee-status"
                  :class="`status-${employee.status}`"
                >
                  {{ getStatusText(employee.status) }}
                </div>
              </div>
              <div class="employee-info">
                <div class="info-item">
                  <div class="info-label">–î–æ–ª–∂–Ω–æ—Å—Ç—å</div>
                  <div class="info-value">{{ employee.position }}</div>
                </div>
                <div class="info-item">
                  <div class="info-label">–ü–æ–ª / –í–æ–∑—Ä–∞—Å—Ç</div>
                  <div class="info-value">
                    {{ employee.gender === 'male' ? '–ú' : '–ñ' }} / {{
                    employee.age }} –ª–µ—Ç
                  </div>
                </div>
                <div class="info-item">
                  <div class="info-label">–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</div>
                  <div class="info-value">
                    {{ getEducationText(employee.education) }}
                  </div>
                </div>
                <div class="info-item">
                  <div class="info-label">–ü–∞—Å–ø–æ—Ä—Ç</div>
                  <div class="info-value">{{ employee.passport }}</div>
                </div>
              </div>
              <div class="employee-actions">
                <button
                  class="btn btn-primary"
                  @click="editEmployee(employee)"
                  v-if="employee.status !== 'fired'"
                  :disabled="loading"
                >
                  –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                </button>
                <button
                  class="btn btn-success"
                  @click="changeStatus(employee.id, 'vacation')"
                  v-if="employee.status === 'active'"
                  :disabled="loading"
                >
                  –í –æ—Ç–ø—É—Å–∫
                </button>
                <button
                  class="btn btn-success"
                  @click="changeStatus(employee.id, 'active')"
                  v-if="employee.status === 'vacation'"
                  :disabled="loading"
                >
                  –í–µ—Ä–Ω—É—Ç—å
                </button>
                <button
                  class="btn btn-danger"
                  @click="fireEmployee(employee)"
                  v-if="employee.status !== 'fired'"
                  :disabled="loading"
                >
                  –£–≤–æ–ª–∏—Ç—å
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ -->
        <div v-if="activeTab === 'create'">
          <div v-if="!selectedDepartmentId" class="empty-state">
            <h3>–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç</h3>
            <p>–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–±—Ä–∞—Ç—å –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç</p>
          </div>
          <form v-else @submit.prevent="createEmployee">
            <div class="form-row">
              <div class="form-group">
                <label>–§–ò–û *</label>
                <input
                  type="text"
                  v-model="newEmployee.fullName"
                  required
                  placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á"
                  :disabled="loading"
                />
              </div>
              <div class="form-group">
                <label>–ü–æ–ª *</label>
                <select
                  v-model="newEmployee.gender"
                  required
                  :disabled="loading"
                >
                  <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª</option>
                  <option value="male">–ú—É–∂—Å–∫–æ–π</option>
                  <option value="female">–ñ–µ–Ω—Å–∫–∏–π</option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>–í–æ–∑—Ä–∞—Å—Ç *</label>
                <input
                  type="number"
                  v-model.number="newEmployee.age"
                  required
                  min="18"
                  max="70"
                  placeholder="30"
                  :disabled="loading"
                />
              </div>
              <div class="form-group">
                <label>–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ *</label>
                <select
                  v-model="newEmployee.education"
                  required
                  :disabled="loading"
                >
                  <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</option>
                  <option value="secondary">–°—Ä–µ–¥–Ω–µ–µ</option>
                  <option value="specialized">–°—Ä–µ–¥–Ω–µ-—Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ</option>
                  <option value="higher">–í—ã—Å—à–µ–µ</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label>–î–æ–ª–∂–Ω–æ—Å—Ç—å *</label>
              <select
                v-model="newEmployee.position"
                required
                :disabled="loading"
              >
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –¥–æ–ª–∂–Ω–æ—Å—Ç—å</option>
                <option
                  v-for="position in positions"
                  :key="position"
                  :value="position"
                >
                  {{ position }}
                </option>
              </select>
            </div>

            <div class="form-group">
              <label>–ü–∞—Å–ø–æ—Ä—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ *</label>
              <input
                type="text"
                v-model="newEmployee.passport"
                required
                placeholder="1234 567890"
                pattern="\d{4} \d{6}"
                title="–§–æ—Ä–º–∞—Ç: 1234 567890"
                :disabled="loading"
              />
            </div>

            <button type="submit" class="btn btn-success" :disabled="loading">
              {{ loading ? '–°–æ–∑–¥–∞–Ω–∏–µ...' : '–°–æ–∑–¥–∞—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞' }}
            </button>
          </form>
        </div>

        <!-- –ü–æ–∏—Å–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ -->
        <div v-if="activeTab === 'search'">
          <div class="search-filters">
            <h3 style="margin-bottom: 20px">–§–∏–ª—å—Ç—Ä—ã –ø–æ–∏—Å–∫–∞</h3>
            <div class="filters-row">
              <div class="form-group">
                <label>–§–ò–û</label>
                <input
                  type="text"
                  v-model="searchFilters.fullName"
                  placeholder="–í–≤–µ–¥–∏—Ç–µ –§–ò–û"
                  :disabled="loading"
                />
              </div>
              <div class="form-group">
                <label>–î–æ–ª–∂–Ω–æ—Å—Ç—å</label>
                <select v-model="searchFilters.position" :disabled="loading">
                  <option value="">–í—Å–µ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏</option>
                  <option
                    v-for="position in positions"
                    :key="position"
                    :value="position"
                  >
                    {{ position }}
                  </option>
                </select>
              </div>
              <div class="form-group">
                <label>–ü–æ–ª</label>
                <select v-model="searchFilters.gender" :disabled="loading">
                  <option value="">–õ—é–±–æ–π</option>
                  <option value="male">–ú—É–∂—Å–∫–æ–π</option>
                  <option value="female">–ñ–µ–Ω—Å–∫–∏–π</option>
                </select>
              </div>
              <div class="form-group">
                <label>–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</label>
                <select v-model="searchFilters.education" :disabled="loading">
                  <option value="">–õ—é–±–æ–µ</option>
                  <option value="secondary">–°—Ä–µ–¥–Ω–µ–µ</option>
                  <option value="specialized">–°—Ä–µ–¥–Ω–µ-—Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ</option>
                  <option value="higher">–í—ã—Å—à–µ–µ</option>
                </select>
              </div>
              <div class="form-group">
                <label>–í–æ–∑—Ä–∞—Å—Ç –æ—Ç</label>
                <input
                  type="number"
                  v-model.number="searchFilters.ageFrom"
                  min="18"
                  max="70"
                  placeholder="18"
                  :disabled="loading"
                />
              </div>
              <div class="form-group">
                <label>–í–æ–∑—Ä–∞—Å—Ç –¥–æ</label>
                <input
                  type="number"
                  v-model.number="searchFilters.ageTo"
                  min="18"
                  max="70"
                  placeholder="70"
                  :disabled="loading"
                />
              </div>
              <div class="form-group">
                <button
                  class="btn btn-primary"
                  @click="searchEmployees"
                  :disabled="loading"
                  style="width: 100%"
                >
                  {{ loading ? '–ü–æ–∏—Å–∫...' : '–ü–æ–∏—Å–∫' }}
                </button>
              </div>
              <div class="form-group">
                <button
                  class="btn btn-secondary"
                  @click="clearFilters"
                  :disabled="loading"
                  style="width: 100%"
                >
                  –û—á–∏—Å—Ç–∏—Ç—å
                </button>
              </div>
            </div>
          </div>

          <div v-if="loading" class="loading">–ü–æ–∏—Å–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤...</div>
          <div
            v-else-if="searchResults.length === 0 && hasSearched"
            class="empty-state"
          >
            <h3>–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
            <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞</p>
          </div>
          <div v-else-if="searchResults.length > 0" class="employee-list">
            <div
              v-for="employee in searchResults"
              :key="employee.id"
              class="employee-card"
              :class="{ fired: employee.status === 'fired' }"
            >
              <div class="employee-header">
                <div class="employee-name">{{ employee.full_name }}</div>
                <div
                  class="employee-status"
                  :class="`status-${employee.status}`"
                >
                  {{ getStatusText(employee.status) }}
                </div>
              </div>
              <div class="employee-info">
                <div class="info-item">
                  <div class="info-label">–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç</div>
                  <div class="info-value">{{ employee.department_name }}</div>
                </div>
                <div class="info-item">
                  <div class="info-label">–î–æ–ª–∂–Ω–æ—Å—Ç—å</div>
                  <div class="info-value">{{ employee.position }}</div>
                </div>
                <div class="info-item">
                  <div class="info-label">–ü–æ–ª / –í–æ–∑—Ä–∞—Å—Ç</div>
                  <div class="info-value">
                    {{ employee.gender === 'male' ? '–ú' : '–ñ' }} / {{
                    employee.age }} –ª–µ—Ç
                  </div>
                </div>
                <div class="info-item">
                  <div class="info-label">–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</div>
                  <div class="info-value">
                    {{ getEducationText(employee.education) }}
                  </div>
                </div>
                <div class="info-item">
                  <div class="info-label">–ü–∞—Å–ø–æ—Ä—Ç</div>
                  <div class="info-value">{{ employee.passport }}</div>
                </div>
              </div>
              <div class="employee-actions">
                <button
                  class="btn btn-primary"
                  @click="editEmployee(employee)"
                  v-if="employee.status !== 'fired'"
                  :disabled="loading"
                >
                  –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                </button>
                <button
                  class="btn btn-success"
                  @click="changeStatus(employee.id, 'vacation')"
                  v-if="employee.status === 'active'"
                  :disabled="loading"
                >
                  –í –æ—Ç–ø—É—Å–∫
                </button>
                <button
                  class="btn btn-success"
                  @click="changeStatus(employee.id, 'active')"
                  v-if="employee.status === 'vacation'"
                  :disabled="loading"
                >
                  –í–µ—Ä–Ω—É—Ç—å
                </button>
                <button
                  class="btn btn-danger"
                  @click="fireEmployee(employee)"
                  v-if="employee.status !== 'fired'"
                  :disabled="loading"
                >
                  –£–≤–æ–ª–∏—Ç—å
                </button>
              </div>
            </div>
          </div>
          <div v-else class="empty-state">
            <h3>–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞</h3>
            <p>–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–¥–∏–Ω –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏ –Ω–∞–∂–º–∏—Ç–µ "–ü–æ–∏—Å–∫"</p>
          </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
        <div v-if="showEditModal" class="modal-overlay" @click="closeEditModal">
          <div class="modal" @click.stop>
            <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</h3>
            <form @submit.prevent="saveEmployee">
              <div class="form-row">
                <div class="form-group">
                  <label>–§–ò–û *</label>
                  <input
                    type="text"
                    v-model="editingEmployee.full_name"
                    required
                    :disabled="loading"
                  />
                </div>
                <div class="form-group">
                  <label>–ü–æ–ª *</label>
                  <select
                    v-model="editingEmployee.gender"
                    required
                    :disabled="loading"
                  >
                    <option value="male">–ú—É–∂—Å–∫–æ–π</option>
                    <option value="female">–ñ–µ–Ω—Å–∫–∏–π</option>
                  </select>
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label>–í–æ–∑—Ä–∞—Å—Ç *</label>
                  <input
                    type="number"
                    v-model.number="editingEmployee.age"
                    required
                    min="18"
                    max="70"
                    :disabled="loading"
                  />
                </div>
                <div class="form-group">
                  <label>–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ *</label>
                  <select
                    v-model="editingEmployee.education"
                    required
                    :disabled="loading"
                  >
                    <option value="secondary">–°—Ä–µ–¥–Ω–µ–µ</option>
                    <option value="specialized">–°—Ä–µ–¥–Ω–µ-—Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ</option>
                    <option value="higher">–í—ã—Å—à–µ–µ</option>
                  </select>
                </div>
              </div>

              <div class="form-group">
                <label>–î–æ–ª–∂–Ω–æ—Å—Ç—å *</label>
                <select
                  v-model="editingEmployee.position"
                  required
                  :disabled="loading"
                >
                  <option
                    v-for="position in positions"
                    :key="position"
                    :value="position"
                  >
                    {{ position }}
                  </option>
                </select>
              </div>

              <div class="form-group">
                <label>–ü–∞—Å–ø–æ—Ä—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ *</label>
                <input
                  type="text"
                  v-model="editingEmployee.passport"
                  required
                  pattern="\d{4} \d{6}"
                  title="–§–æ—Ä–º–∞—Ç: 1234 567890"
                  :disabled="loading"
                />
              </div>

              <div style="display: flex; gap: 15px; margin-top: 25px">
                <button
                  type="submit"
                  class="btn btn-success"
                  :disabled="loading"
                >
                  {{ loading ? '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...' : '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å' }}
                </button>
                <button
                  type="button"
                  class="btn btn-secondary"
                  @click="closeEditModal"
                  :disabled="loading"
                >
                  –û—Ç–º–µ–Ω–∞
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <script>
      const { createApp, ref, computed, onMounted, watch } = Vue;

      createApp({
        setup() {
          // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
          const activeTab = ref("list");
          const selectedDepartmentId = ref("");
          const showEditModal = ref(false);
          const editingEmployee = ref(null);
          const loading = ref(false);
          const error = ref("");
          const success = ref("");
          const hasSearched = ref(false);

          // –î–∞–Ω–Ω—ã–µ
          const departments = ref([]);
          const positions = ref([]);
          const employees = ref([]);
          const searchResults = ref([]);

          // –§–æ—Ä–º—ã
          const newEmployee = ref({
            fullName: "",
            gender: "",
            age: "",
            education: "",
            position: "",
            passport: "",
          });

          const searchFilters = ref({
            fullName: "",
            position: "",
            gender: "",
            education: "",
            ageFrom: "",
            ageTo: "",
          });

          // API —Ñ—É–Ω–∫—Ü–∏–∏
          const api = {
            async get(url) {
              const response = await fetch(`/api${url}`);
              if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || "–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞");
              }
              return response.json();
            },

            async post(url, data) {
              const response = await fetch(`/api${url}`, {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify(data),
              });
              if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || "–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞");
              }
              return response.json();
            },

            async put(url, data) {
              const response = await fetch(`/api${url}`, {
                method: "PUT",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify(data),
              });
              if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || "–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞");
              }
              return response.json();
            },

            async patch(url, data) {
              const response = await fetch(`/api${url}`, {
                method: "PATCH",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify(data),
              });
              if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || "–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞");
              }
              return response.json();
            },
          };

          // –í—ã—á–∏—Å–ª—è–µ–º—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞
          const selectedDepartment = computed(() => {
            return departments.value.find(
              (d) => d.id === selectedDepartmentId.value
            );
          });

          const activeEmployees = computed(() => {
            return employees.value.filter((emp) => emp.status !== "fired");
          });

          // –ú–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
          const showError = (message) => {
            error.value = message;
            success.value = "";
            setTimeout(() => {
              error.value = "";
            }, 5000);
          };

          const showSuccess = (message) => {
            success.value = message;
            error.value = "";
            setTimeout(() => {
              success.value = "";
            }, 3000);
          };

          // –ú–µ—Ç–æ–¥—ã –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
          const loadDepartments = async () => {
            try {
              const result = await api.get("/departments");
              departments.value = result.data;
            } catch (err) {
              showError("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–≤: " + err.message);
            }
          };

          const loadPositions = async () => {
            try {
              const result = await api.get("/positions");
              positions.value = result.data;
            } catch (err) {
              showError("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ–ª–∂–Ω–æ—Å—Ç–µ–π: " + err.message);
            }
          };

          const loadEmployees = async () => {
            if (!selectedDepartmentId.value) {
              employees.value = [];
              return;
            }

            loading.value = true;
            try {
              const result = await api.get(
                `/employees/department/${selectedDepartmentId.value}`
              );
              employees.value = result.data;
            } catch (err) {
              showError("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤: " + err.message);
              employees.value = [];
            } finally {
              loading.value = false;
            }
          };

          // –ú–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏
          const createEmployee = async () => {
            loading.value = true;
            try {
              await api.post("/employees", {
                fullName: newEmployee.value.fullName,
                gender: newEmployee.value.gender,
                age: newEmployee.value.age,
                education: newEmployee.value.education,
                position: newEmployee.value.position,
                passport: newEmployee.value.passport,
                departmentId: selectedDepartmentId.value,
              });

              // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
              newEmployee.value = {
                fullName: "",
                gender: "",
                age: "",
                education: "",
                position: "",
                passport: "",
              };

              showSuccess("‚úÖ –°–æ—Ç—Ä—É–¥–Ω–∏–∫ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!");
              await loadEmployees();
              setActiveTab("list");
            } catch (err) {
              showError("–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞: " + err.message);
            } finally {
              loading.value = false;
            }
          };

          const editEmployee = (employee) => {
            editingEmployee.value = { ...employee };
            showEditModal.value = true;
          };

          const saveEmployee = async () => {
            loading.value = true;
            try {
              await api.put(`/employees/${editingEmployee.value.id}`, {
                fullName: editingEmployee.value.full_name,
                gender: editingEmployee.value.gender,
                age: editingEmployee.value.age,
                education: editingEmployee.value.education,
                position: editingEmployee.value.position,
                passport: editingEmployee.value.passport,
              });

              closeEditModal();
              showSuccess("‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω—ã!");
              await loadEmployees();
              if (activeTab.value === "search" && hasSearched.value) {
                await searchEmployees();
              }
            } catch (err) {
              showError("–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞: " + err.message);
            } finally {
              loading.value = false;
            }
          };

          const closeEditModal = () => {
            showEditModal.value = false;
            editingEmployee.value = null;
          };

          const changeStatus = async (employeeId, newStatus) => {
            const statusTexts = {
              vacation: "–æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ –æ—Ç–ø—É—Å–∫",
              active: "–≤–µ—Ä–Ω—É—Ç—å –∏–∑ –æ—Ç–ø—É—Å–∫–∞",
              fired: "—É–≤–æ–ª–∏—Ç—å",
            };

            if (confirm(`–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ: ${statusTexts[newStatus]}?`)) {
              loading.value = true;
              try {
                await api.patch(`/employees/${employeeId}/status`, {
                  status: newStatus,
                });

                const statusMessages = {
                  vacation: "üèùÔ∏è –°–æ—Ç—Ä—É–¥–Ω–∏–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ –æ—Ç–ø—É—Å–∫",
                  active: "üíº –°–æ—Ç—Ä—É–¥–Ω–∏–∫ –≤–µ—Ä–Ω—É–ª—Å—è –∏–∑ –æ—Ç–ø—É—Å–∫–∞",
                  fired: "üö™ –°–æ—Ç—Ä—É–¥–Ω–∏–∫ —É–≤–æ–ª–µ–Ω",
                };

                showSuccess(statusMessages[newStatus]);
                await loadEmployees();
                if (activeTab.value === "search" && hasSearched.value) {
                  await searchEmployees();
                }
              } catch (err) {
                showError("–û—à–∏–±–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞: " + err.message);
              } finally {
                loading.value = false;
              }
            }
          };

          const fireEmployee = async (employee) => {
            await changeStatus(employee.id, "fired");
          };

          const searchEmployees = async () => {
            loading.value = true;
            hasSearched.value = true;
            try {
              const result = await api.post(
                "/employees/search",
                searchFilters.value
              );
              searchResults.value = result.data;
            } catch (err) {
              showError("–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤: " + err.message);
              searchResults.value = [];
            } finally {
              loading.value = false;
            }
          };

          const clearFilters = () => {
            searchFilters.value = {
              fullName: "",
              position: "",
              gender: "",
              education: "",
              ageFrom: "",
              ageTo: "",
            };
            searchResults.value = [];
            hasSearched.value = false;
          };

          // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã
          const setActiveTab = (tab) => {
            activeTab.value = tab;
            error.value = "";
            success.value = "";
          };

          const getStatusText = (status) => {
            const statusMap = {
              active: "–ê–∫—Ç–∏–≤–µ–Ω",
              vacation: "–í –æ—Ç–ø—É—Å–∫–µ",
              fired: "–£–≤–æ–ª–µ–Ω",
            };
            return statusMap[status] || status;
          };

          const getEducationText = (education) => {
            const educationMap = {
              secondary: "–°—Ä–µ–¥–Ω–µ–µ",
              specialized: "–°—Ä–µ–¥–Ω–µ-—Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ",
              higher: "–í—ã—Å—à–µ–µ",
            };
            return educationMap[education] || education;
          };

          // Watchers
          watch(selectedDepartmentId, () => {
            if (selectedDepartmentId.value) {
              loadEmployees();
            }
          });

          // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
          watch(
            searchFilters,
            () => {
              if (activeTab.value === "search" && hasSearched.value) {
                const debounceTimer = setTimeout(() => {
                  searchEmployees();
                }, 500);
                return () => clearTimeout(debounceTimer);
              }
            },
            { deep: true }
          );

          // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
          onMounted(async () => {
            await loadDepartments();
            await loadPositions();
          });

          return {
            // –°–æ—Å—Ç–æ—è–Ω–∏–µ
            activeTab,
            selectedDepartmentId,
            showEditModal,
            editingEmployee,
            loading,
            error,
            success,
            hasSearched,

            // –î–∞–Ω–Ω—ã–µ
            departments,
            positions,
            employees,
            searchResults,
            newEmployee,
            searchFilters,

            // –í—ã—á–∏—Å–ª—è–µ–º—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞
            selectedDepartment,
            activeEmployees,

            // –ú–µ—Ç–æ–¥—ã
            setActiveTab,
            loadEmployees,
            createEmployee,
            editEmployee,
            saveEmployee,
            closeEditModal,
            changeStatus,
            fireEmployee,
            searchEmployees,
            clearFilters,
            getStatusText,
            getEducationText,
          };
        },
      }).mount("#app");
    </script>
  </body>
</html>
